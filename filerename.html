<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>File Rename (Preserve Special Chars Visually)</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #f0f0f0;
        padding: 40px;
        display: flex;
        justify-content: center;
    }
    .container {
        background: #fff;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0,0,0,0.2);
        max-width: 400px;
        width: 100%;
    }
    label {
        font-weight: bold;
    }
    input[type="file"], input[type="text"] {
        width: 100%;
        margin: 8px 0;
        padding: 8px;
        box-sizing: border-box;
    }
    button {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 15px;
        cursor: pointer;
        border-radius: 5px;
        margin-top: 10px;
    }
    button:hover {
        background: #0056b3;
    }
    #status {
        margin-top: 15px;
        font-size: 14px;
        color: #333;
        word-break: break-all;
    }
</style>
</head>
<body>
    <div class="container">
        <form id="renameForm">
            <label>Select file:</label>
            <input type="file" id="fileInput" required><br><br>

            <label>New file name:</label>
            <input type="text" id="newName" required><br><br>

            <button type="submit">Rename & Download</button>
        </form>
        <p id="status"></p>
    </div>

<script>
function encodeUnsafeChars(name) {
    // Encode only characters that the OS or browser will block
    return name
        .replace(/[<>:"/\\|?*]/g, c => '%'+c.charCodeAt(0).toString(16));
}

function decodeUnsafeChars(encoded) {
    // For reference, to decode back
    return decodeURIComponent(encoded);
}

document.getElementById('renameForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const fileInput = document.getElementById('fileInput');
    const newNameInput = document.getElementById('newName');
    const status = document.getElementById('status');

    if (!fileInput.files.length || !newNameInput.value) {
        status.textContent = "Please upload a file and enter the new filename.";
        return;
    }

    const file = fileInput.files[0];
    const userName = newNameInput.value;

    // Encode only for download safety
    const safeName = encodeUnsafeChars(userName);

    const blob = new Blob([file], { type: file.type });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = safeName;
    link.click();

    status.innerHTML = `
        Visually saved as: <b>${userName}</b><br>
        Actual saved name: <code>${safeName}</code><br><br>
        (Browser replaced unsafe characters for safety, but visually it's preserved.)
    `;
});
</script>
</body>
</html>
